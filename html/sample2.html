<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap"
    rel="stylesheet">
    <style>
        @layer base {
            body {
                font-family: Josefin Sans, sans-serif;
                background-color: white;
            }
            .font-arabic {
                font-family: "Noto Nastaliq Urdu", serif;
            }
        }

        @layer components {
    .menu__link::before {
      content: '';
      width: 0;
      height: 2px;
      border-radius: 2px;
      background-color: #fff;
      position: absolute;
      bottom: -0.25rem;
      right: 0;
      transition: right 0.4s, width 0.4s, left 0.4s;
    }
    
    .menu__link:hover::before {
      width: 100%;
      left: 0;
    }
  }

        #intro {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            overflow: hidden;
            opacity: 1;
            transition: opacity 2s ease-in-out;
        }
        #intro.fade-out {
            opacity: 0;
        }
        .hidden-content {
            display: none;
        }

    </style>
</head>
<body >
    <div id="intro">
        <img src="/images/intro.png" alt="Intro" class="w-40">
    </div>
    <nav class="bg-cyan-600">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-4">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center gap-5">
                    <img src="/images/intro.png" alt="The logo of website" class="w-12">
                    <a href="#" class="text-white font-semibold text-2xl">SearchAyah</a>
                </div>
                <div class="hidden md:flex gap-10">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#" class="menu__link relative text-cyan-100 hover:text-white px-3 py-2 rounded-md text-lg font-normal">Quran</a>
                        <a href="#" class="menu__link relative text-cyan-100 hover:text-white px-3 py-2 rounded-md text-lg font-normal">Hadith</a>
                        <a href="#" class="menu__link relative text-cyan-100 hover:text-white px-3 py-2 rounded-md text-lg font-normal">Sahaba</a>
                        <a href="#" class="menu__link relative text-cyan-100 hover:text-white px-3 py-2 rounded-md text-lg font-normal">Islamic Books</a>
                    </div>
                    <button class="px-4 py-2 bg-cyan-500 hover:bg-transparent border border-cyan-500 hover:border-white text-gray-50 transition delay-200 rounded-xl flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M3 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zm7.707 3.293a1 1 0 010 1.414L9.414 9H17a1 1 0 110 2H9.414l1.293 1.293a1 1 0 01-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0z"
                                clip-rule="evenodd" /> 
                        </svg>
                        <span>Login</span>
                    </button>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" type="button" class="text-cyan-100 hover:bg-cyan-700 hover:text-white inline-flex items-center justify-center p-2 rounded-md focus:outline-none">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#" class="text-cyan-100 hover:bg-cyan-700 hover:text-white block px-3 py-2 rounded-md text-lg font-normal">Quran</a>
                <a href="#" class="text-cyan-100 hover:bg-cyan-700 hover:text-white block px-3 py-2 rounded-md text-lg font-normal">Hadith</a>
                <a href="#" class="text-cyan-100 hover:bg-cyan-700 hover:text-white block px-3 py-2 rounded-md text-lg font-normal">Sahaba</a>
                <a href="#" class="text-cyan-100 hover:bg-cyan-700 hover:text-white block px-3 py-2 rounded-md text-lg font-normal">Islamic Books</a>
            </div>
        </div>
    </nav>
   
    <div class="max-w-5xl mx-auto p-4 mt-16">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <input type="text" id="searchBox" placeholder="Search Word or Ayat of Quran" class="w-full h-12 px-4 rounded-lg border-2 border-cyan-500 focus:outline-none focus:border-cyan-600 text-lg mb-4">
            
            <div class="mt-4 flex items-center justify-between">
                <label for="languageSelect" class="mr-2 text-cyan-700">Translation Languages</label>
                <select id="languageSelect" class="px-4 py-2 rounded-lg border-2 border-cyan-500 focus:outline-none focus:border-cyan-600 text-cyan-800">
                    <option value="english">English</option>
                    <option value="urdu">اردو</option>
                </select>
            </div>

            <div id="searchInfo" class="hidden my-5 bg-cyan-50 rounded-lg p-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 mr-2 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                        </svg>
                        <span class="font-semibold text-cyan-700">FILTER</span>
                    </div>
                    <div class="text-sm text-cyan-600">
                        Searching Arabic text and selected translation
                    </div>
                </div>
                
                <div id="resultCount" class="text-sm text-cyan-600 mt-2"></div>
            </div>
            
            <div id="searchResults" class="space-y-10"></div>
        </div>
        
    </div>

    <button id="scrollToTopBtn" class="hidden w-12 h-12 fixed bottom-5 right-5 z-50 border-none outline-none bg-cyan-500 bg-opacity-70 text-white cursor-pointer rounded-full text-xl transition-opacity duration-300" title="Go to top">↑</button>

    <script>
        let quranData = [];
        let urduTranslation = [];

        async function fetchQuranData() {
            try {
                // Fetch Arabic text
                const arabicResponse = await fetch('https://api.quran.com/api/v4/quran/verses/uthmani');
                if (!arabicResponse.ok) throw new Error('Network response was not ok for Arabic text');
                const arabicData = await arabicResponse.json();

                // Fetch English translation
                const englishResponse = await fetch('https://api.quran.com/api/v4/quran/translations/131');
                if (!englishResponse.ok) throw new Error('Network response was not ok for English translation');
                const englishData = await englishResponse.json();

                // Fetch Urdu translation
                const urduResponse = await fetch('https://api.quran.com/api/v4/quran/translations/97');
                if (!urduResponse.ok) throw new Error('Network response was not ok for Urdu translation');
                const urduData = await urduResponse.json();

                // Combine Arabic, English, and Urdu data
                quranData = arabicData.verses.map((verse, index) => ({
                    surah: { number: Math.floor(verse.verse_key.split(':')[0]), englishName: '' },
                    numberInSurah: parseInt(verse.verse_key.split(':')[1]),
                    text: verse.text_uthmani,
                    englishTranslation: englishData.translations[index].text,
                    urduTranslation: urduData.translations[index].text
                }));

                await loadSurahNames();
                console.log('Quran data loaded successfully');
            } catch (error) {
                console.error('Error fetching Quran data:', error);
            }
        }

        async function loadSurahNames() {
            try {
                const response = await fetch('https://api.quran.com/api/v4/chapters');
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                const surahNames = data.chapters.reduce((acc, surah) => {
                    acc[surah.id] = surah.name_simple;
                    return acc;
                }, {});
                
                quranData.forEach(ayah => {
                    ayah.surah.englishName = `Surah ${surahNames[ayah.surah.number]}`;
                });
            } catch (error) {
                console.error('Error loading surah names:', error);
            }
        }

        // Search function
        async function searchAyah(query) {
            if (quranData.length === 0) {
                await fetchQuranData();
            }

            const matches = [];
            const lowerQuery = query.toLowerCase();
            const selectedLanguage = document.getElementById('languageSelect').value;

            for (const ayah of quranData) {
                if (ayah.text.includes(query) || 
                    ayah[`${selectedLanguage}Translation`].toLowerCase().includes(lowerQuery)) {
                    matches.push(ayah);
                }
            }

            return matches;
        }

        // Event listener for search input
        let debounceTimeout;
        document.getElementById('searchBox').addEventListener('input', function() {
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(async () => {
                const query = this.value;
                if (query.length > 2) {
                    const matches = await searchAyah(query);
                    displaySearchResults(matches, query);
                }
            }, 300);
        });

        // Event listener for language selection
        document.getElementById('languageSelect').addEventListener('change', async function() {
            const query = document.getElementById('searchBox').value;
            if (query.length > 2) {
                const matches = await searchAyah(query);
                displaySearchResults(matches, query);
            }
        });

        let currentPage = 1;
        const resultsPerPage = 20;
        let allMatches = [];

        function displaySearchResults(matches, query, isNewSearch = true) {
            const searchResults = document.getElementById('searchResults');
            const searchInfo = document.getElementById('searchInfo');
            const resultCount = document.getElementById('resultCount');
            const selectedLanguage = document.getElementById('languageSelect').value;

            if (isNewSearch) {
                searchResults.innerHTML = '';
                currentPage = 1;
                allMatches = matches;
            }

            if (!Array.isArray(allMatches) || allMatches.length === 0) {
                searchResults.innerHTML = '<div class="p-4 bg-cyan-100 rounded-lg text-cyan-700">No matches found</div>';
                searchInfo.classList.add('hidden');
                return;
            }

            searchInfo.classList.remove('hidden');
            resultCount.textContent = `${allMatches.length} Search Results`;

            const startIndex = (currentPage - 1) * resultsPerPage;
            const endIndex = startIndex + resultsPerPage;
            const currentMatches = allMatches.slice(startIndex, endIndex);

            // Remove existing "Load More" button if it exists
            const existingLoadMoreBtn = document.getElementById('loadMoreBtn');
            if (existingLoadMoreBtn) {
                existingLoadMoreBtn.remove();
            }

            // Create a container for the new results
            const newResultsContainer = document.createElement('div');

            currentMatches.forEach(match => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'bg-white rounded-lg shadow-md overflow-hidden mb-4';
                resultDiv.innerHTML = `
                    <div class="bg-cyan-600 py-2 px-4">
                        <h3 class="text-white font-semibold">${match.surah.englishName} ${match.numberInSurah}</h3>
                    </div>
                    <div class="px-4 pb-4 pt-8">
                        <div class="mb-8 text-right" dir="rtl">
                            <span class="text-2xl font-arabic text-cyan-900 leading-4">${match.text}</span>
                        </div>
                        <p class="text-cyan-800 ${selectedLanguage === 'urdu' ? 'text-right' : ''}" ${selectedLanguage === 'urdu' ? 'dir="rtl"' : ''}>
                            ${highlightSearchTerm(match[`${selectedLanguage}Translation`], query)}
                        </p>
                    </div>
                `;
                newResultsContainer.appendChild(resultDiv);
            });

            // Append the new results to the search results container
            searchResults.appendChild(newResultsContainer);

            // Add "Load More" button if there are more results
            if (endIndex < allMatches.length) {
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.id = 'loadMoreBtn';
                loadMoreBtn.className = 'w-full py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition duration-300';
                loadMoreBtn.textContent = 'Load More';
                loadMoreBtn.addEventListener('click', () => {
                    currentPage++;
                    displaySearchResults(allMatches, query, false);
                });
                searchResults.appendChild(loadMoreBtn);
            }

            // Scroll to the newly added results
            if (!isNewSearch) {
                newResultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Highlight search term in text
        function highlightSearchTerm(text, term) {
            const regex = new RegExp(`(${term})`, 'gi');
            return text.replace(regex, '<mark class="bg-cyan-200 text-cyan-900">$1</mark>');
        }

        // Scroll to top functionality
        const scrollToTopBtn = document.getElementById("scrollToTopBtn");

        window.onscroll = function() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                scrollToTopBtn.style.display = "block";
            } else {
                scrollToTopBtn.style.display = "none";
            }
        };

        scrollToTopBtn.addEventListener("click", function() {
            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    mobileMenuButton.addEventListener('click', function() {
        mobileMenu.classList.toggle('hidden');
    });
});

        // Intro animation
        document.addEventListener('DOMContentLoaded', () => {
            const intro = document.getElementById('intro');
            const contentDivs = document.querySelectorAll('body > div:not(#intro)');

            intro.style.display = 'flex';
            contentDivs.forEach(div => div.classList.add('hidden-content'));

            setTimeout(() => {
                intro.classList.add('fade-out');
                setTimeout(() => {
                    intro.style.display = 'none';
                    contentDivs.forEach(div => div.classList.remove('hidden-content'));
                }, 2000);
            }, 3000);

            // Fetch Quran data when the page loads
            fetchQuranData();
        });
    </script>
</body>
</html>