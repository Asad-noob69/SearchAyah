<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Hadith | Search Ayah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap"
    rel="stylesheet">
    <style>
         @layer base {
            body {
                font-family: Josefin Sans, sans-serif;
                background-color: white;
            }
            .font-arabic {
                font-family: "Noto Nastaliq Urdu", serif;
            }
        }
        @layer components {
        .menu__link::before {
            content: '';
            width: 0;
            height: 2px;
            border-radius: 2px;
            background-color: #fff;
            position: absolute;
            bottom: -0.25rem;
            right: 0;
            transition: right 0.4s, width 0.4s, left 0.4s;
        }
    
        .menu__link:hover::before {
            width: 100%;
            left: 0;
            }
        }
    </style>
</head>
<body>
    <nav class="bg-cyan-600">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-4">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center gap-5">
                    <img src="/images/intro.png" alt="The logo of website" class="w-12">
                    <a href="#" class="text-white font-semibold text-2xl">SearchAyah</a>
                </div>
                <div class="hidden md:flex gap-10">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#" class="menu__link relative text-cyan-100 hover:text-white px-3 py-2 rounded-md text-lg font-normal">Quran</a>
                        <a href="#" class="menu__link relative text-cyan-100 hover:text-white px-3 py-2 rounded-md text-lg font-normal">Hadith</a>
                        <a href="#" class="menu__link relative text-cyan-100 hover:text-white px-3 py-2 rounded-md text-lg font-normal">Sahaba</a>
                        <a href="#" class="menu__link relative text-cyan-100 hover:text-white px-3 py-2 rounded-md text-lg font-normal">Islamic Books</a>
                    </div>
                    <button class="px-4 py-2 bg-cyan-500 hover:bg-transparent border border-cyan-500 hover:border-white text-gray-50 transition delay-200 rounded-xl flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M3 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zm7.707 3.293a1 1 0 010 1.414L9.414 9H17a1 1 0 110 2H9.414l1.293 1.293a1 1 0 01-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0z"
                                clip-rule="evenodd" /> 
                        </svg>
                        <span>Login</span>
                    </button>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" type="button" class="text-cyan-100 hover:bg-cyan-700 hover:text-white inline-flex items-center justify-center p-2 rounded-md focus:outline-none">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#" class="text-cyan-100 hover:bg-cyan-700 hover:text-white block px-3 py-2 rounded-md text-lg font-normal">Quran</a>
                <a href="#" class="text-cyan-100 hover:bg-cyan-700 hover:text-white block px-3 py-2 rounded-md text-lg font-normal">Hadith</a>
                <a href="#" class="text-cyan-100 hover:bg-cyan-700 hover:text-white block px-3 py-2 rounded-md text-lg font-normal">Sahaba</a>
                <a href="#" class="text-cyan-100 hover:bg-cyan-700 hover:text-white block px-3 py-2 rounded-md text-lg font-normal">Islamic Books</a>
            </div>
        </div>
    </nav>
    <div class="max-w-5xl mx-auto p-4 mt-16">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <input type="text" id="searchBox" placeholder="Search Hadith With Word" class="w-full h-12 px-4 rounded-lg border-2 border-cyan-500 focus:outline-none focus:border-cyan-600 text-lg mb-4">
            
            <div class="mt-4 flex items-center justify-between">
                <label for="languageSelect" class="mr-2 text-cyan-700">Translation Languages</label>
                <select id="languageSelect" class="px-4 py-2 rounded-lg border-2 border-cyan-500 focus:outline-none focus:border-cyan-600 text-cyan-800">
                    <option value="english">English</option>
                    <option value="urdu">اردو</option>
                </select>
            </div>

            <div class="mt-4 flex items-center justify-between">
                <label for="bookSelect" class="mr-2 text-cyan-700">Select Hadith Book</label>
                <select id="bookSelect" class="px-4 py-2 rounded-lg border-2 border-cyan-500 focus:outline-none focus:border-cyan-600 text-cyan-800">
                    <option value="eng-bukhari">Sahih al-Bukhari</option>
                    <option value="eng-ibnmajah">Sunan Ibn Majah</option>
                    <option value="eng-malik">Muwatta Malik</option>
                    <option value="eng-muslim">Sahih Muslim</option>
                    <option value="eng-nasai">Sunan an-Nasa'i</option>
                    <option value="eng-tirmidhi">Jami` at-Tirmidhi</option>
                </select>
            </div>

            <div id="searchInfo" class="hidden my-5 bg-cyan-50 rounded-lg p-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 mr-2 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                        </svg>
                        <span class="font-semibold text-cyan-700">FILTER</span>
                    </div>
                    <div class="text-sm text-cyan-600">
                        Searching Hadith text
                    </div>
                </div>
                
                <div id="resultCount" class="text-sm text-cyan-600 mt-2"></div>
            </div>
            
            <div id="searchResults" class="space-y-10"></div>
        </div>
        
    </div>

    <button id="scrollToTopBtn" class="hidden w-12 h-12 fixed bottom-5 right-5 z-50 border-none outline-none bg-cyan-500 bg-opacity-70 text-white cursor-pointer rounded-full text-xl transition-opacity duration-300" title="Go to top">↑</button>
    <script>
        let hadithData = {};
        let arabicHadithData = {};

        async function fetchHadithData(book) {
            if (hadithData[book]) return;
            try {
                const response = await fetch(`https://cdn.jsdelivr.net/gh/fawazahmed0/hadith-api@1/editions/${book}.json`);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                hadithData[book] = data.hadiths;
                console.log(`Hadith data for ${book} loaded successfully`);

                // Fetch corresponding Arabic book data
                const arabicBook = 'ara-' + book.split('-')[1];
                const arabicResponse = await fetch(`https://cdn.jsdelivr.net/gh/fawazahmed0/hadith-api@1/editions/${arabicBook}.json`);
                if (!arabicResponse.ok) throw new Error('Network response was not ok for Arabic book');
                const arabicData = await arabicResponse.json();
                arabicHadithData[book] = arabicData.hadiths;
                console.log(`Arabic Hadith data for ${arabicBook} loaded successfully`);
            } catch (error) {
                console.error(`Error fetching Hadith data for ${book}:`, error);
            }
        }

        // Search function
        function searchHadith(query, book) {
            const matches = [];
            const lowerQuery = query.toLowerCase();

            for (const hadith of hadithData[book]) {
                if (hadith.text.toLowerCase().includes(lowerQuery)) {
                    matches.push(hadith);
                }
            }

            return matches;
        }

        // Event listener for search input
        let debounceTimeout;
        document.getElementById('searchBox').addEventListener('input', function() {
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(() => {
                const query = this.value;
                const selectedBook = document.getElementById('bookSelect').value;
                if (query.length > 2) {
                    const matches = searchHadith(query, selectedBook);
                    displaySearchResults(matches, query);
                }
            }, 300);
        });

        let currentPage = 1;
        const resultsPerPage = 20;
        let allMatches = [];

        function displaySearchResults(matches, query, isNewSearch = true) {
            const searchResults = document.getElementById('searchResults');
            const searchInfo = document.getElementById('searchInfo');
            const resultCount = document.getElementById('resultCount');

            if (isNewSearch) {
                searchResults.innerHTML = '';
                currentPage = 1;
                allMatches = matches;
            }

            if (!Array.isArray(allMatches) || allMatches.length === 0) {
                searchResults.innerHTML = '<div class="p-4 bg-cyan-100 rounded-lg text-cyan-700">No matches found</div>';
                searchInfo.classList.add('hidden');
                return;
            }

            searchInfo.classList.remove('hidden');
            resultCount.textContent = `${allMatches.length} Search Results`;

            const startIndex = (currentPage - 1) * resultsPerPage;
            const endIndex = startIndex + resultsPerPage;
            const currentMatches = allMatches.slice(startIndex, endIndex);

            // Remove existing "Load More" button if it exists
            const existingLoadMoreBtn = document.getElementById('loadMoreBtn');
            if (existingLoadMoreBtn) {
                existingLoadMoreBtn.remove();
            }

            // Create a container for the new results
            const newResultsContainer = document.createElement('div');

            currentMatches.forEach(match => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'bg-white rounded-lg shadow-md overflow-hidden mb-4';
                
                // Find corresponding Arabic hadith
                const arabicMatch = arabicHadithData[document.getElementById('bookSelect').value].find(h => h.hadithnumber === match.hadithnumber);
                
                resultDiv.innerHTML = `
                    <div class="bg-cyan-600 py-2 px-4">
                        <h3 class="text-white font-semibold">Hadith ${match.hadithnumber}</h3>
                    </div>
                    <div class="px-4 pb-4 pt-8">
                        <p class="text-cyan-800 font-arabic text-right text-xl" dir="rtl">
                            ${arabicMatch ? arabicMatch.text : 'Arabic text not available'}
                        </p>
                        <p class="text-cyan-800 my-10">
                            ${highlightSearchTerm(match.text, query)}
                        </p>
                    </div>
                `;
                newResultsContainer.appendChild(resultDiv);
            });

            // Append the new results to the search results container
            searchResults.appendChild(newResultsContainer);

            // Add "Load More" button if there are more results
            if (endIndex < allMatches.length) {
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.id = 'loadMoreBtn';
                loadMoreBtn.className = 'w-full py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition duration-300';
                loadMoreBtn.textContent = 'Load More';
                loadMoreBtn.addEventListener('click', () => {
                    currentPage++;
                    displaySearchResults(allMatches, query, false);
                });
                searchResults.appendChild(loadMoreBtn);
            }

            // Scroll to the newly added results
            if (!isNewSearch) {
                newResultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Highlight search term in text
        function highlightSearchTerm(text, term) {
            const regex = new RegExp(`(${term})`, 'gi');
            return text.replace(regex, '<mark class="bg-cyan-200 text-cyan-900">$1</mark>');
        }

        // Scroll to top functionality
        const scrollToTopBtn = document.getElementById("scrollToTopBtn");

        window.onscroll = function() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                scrollToTopBtn.style.display = "block";
            } else {
                scrollToTopBtn.style.display = "none";
            }
        };

        scrollToTopBtn.addEventListener("click", function() {
            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuButton.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });

            // Fetch Hadith data for the initially selected book
            const initialBook = document.getElementById('bookSelect').value;
            fetchHadithData(initialBook);

            // Add event listener for book selection change
            document.getElementById('bookSelect').addEventListener('change', function() {
                const selectedBook = this.value;
                fetchHadithData(selectedBook);
            });
        });
    </script>
</body>
</html>